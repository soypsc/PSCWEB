<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SGL1 - Recibir en Sucursal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="config.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .sidebar-link.active { background-color: #ecfdf5; color: #059669; font-weight: 600; }
        .code { font-size: 13px; font-weight: 600; color: #94a3b8; margin-right: 12px; background-color: #f1f5f9; padding: 2px 8px; border-radius: 6px; }
        #sidebar { transition: transform 0.3s ease-in-out; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <div class="relative min-h-screen md:flex">
        <!-- Menú Móvil y Barra Lateral -->
        <div class="bg-white text-slate-800 flex justify-between md:hidden sticky top-0 z-20 shadow-md">
            <a href="./dashboard.html" class="block p-4 font-bold">SGL1</a>
            <button id="mobile-menu-button" class="p-4 focus:outline-none focus:bg-slate-200">
                <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" /></svg>
            </button>
        </div>
        <aside id="sidebar" class="bg-white text-slate-600 w-64 p-4 space-y-6 fixed inset-y-0 left-0 transform -translate-x-full md:relative md:translate-x-0 z-30 shadow-lg md:shadow-none">
            <div class="flex items-center gap-3 mb-8 px-2"><div class="bg-emerald-500 p-2 rounded-lg"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" /></svg></div><h1 class="text-xl font-bold text-slate-800">SGL1</h1></div>
            <nav>
                <h2 class="text-xs font-semibold text-slate-400 uppercase tracking-wider mb-2 px-4">Operaciones</h2>
                <a href="./dashboard.html" class="sidebar-link flex items-center gap-3 px-4 py-2 rounded-lg" data-path="dashboard.html"><span>Dashboard</span></a>
                <a href="./recibir-paquete.html" class="sidebar-link flex items-center gap-3 px-4 py-2 rounded-lg" data-path="recibir-paquete.html"><span>Recibir Paquete</span></a>
                <a href="./recibir-en-sucursal.html" class="sidebar-link flex items-center gap-3 px-4 py-2 rounded-lg" data-path="recibir-en-sucursal.html"><span>Recibir en Sucursal</span></a>
                <a href="./clientes.html" class="sidebar-link flex items-center gap-3 px-4 py-2 rounded-lg" data-path="clientes.html"><span>Clientes</span></a>
                <a href="./paquetes.html" class="sidebar-link flex items-center gap-3 px-4 py-2 rounded-lg" data-path="paquetes.html"><span>Paquetes</span></a>
                <a href="./sucursales.html" class="sidebar-link flex items-center gap-3 px-4 py-2 rounded-lg" data-path="sucursales.html"><span>Sucursales</span></a>
                <a href="./cobrar.html" class="sidebar-link flex items-center gap-3 px-4 py-2 rounded-lg" data-path="cobrar.html"><span>Cobrar y Facturar</span></a>
                <h2 class="text-xs font-semibold text-slate-400 uppercase tracking-wider mt-6 mb-2 px-4 pt-4 border-t">Administración</h2>
                <a href="./usuarios.html" class="sidebar-link flex items-center gap-3 px-4 py-2 rounded-lg" data-path="usuarios.html"><span>Usuarios y Roles</span></a>
                <a href="./configuracion.html" class="sidebar-link flex items-center gap-3 px-4 py-2 rounded-lg" data-path="configuracion.html"><span>Configuración</span></a>
                <a href="./notificaciones.html" class="sidebar-link flex items-center gap-3 px-4 py-2 rounded-lg" data-path="notificaciones.html"><span>Notificaciones</span></a>
                <a href="./anaqueles.html" class="sidebar-link flex items-center gap-3 px-4 py-2 rounded-lg" data-path="anaqueles.html"><span>Anaqueles</span></a>
            </nav>
        </aside>

        <!-- Contenido Principal -->
        <main class="flex-1 p-8">
            <h1 class="text-3xl font-bold text-slate-900 flex items-center mb-8"><span class="code">[OP-04A]</span>Recepción en Sucursal</h1>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="lg:col-span-2">
                    <div class="bg-white p-6 rounded-lg border border-slate-200 shadow-sm">
                        <label for="tracking-sucursal-main" class="block text-lg font-semibold text-slate-700 mb-2">Escanear Paquete</label>
                        <input type="text" id="tracking-sucursal-main" placeholder="Esperando escaneo de tracking interno..." class="w-full text-lg pl-4 pr-4 py-3 border-2 border-slate-300 rounded-lg">
                    </div>
                    <div class="bg-white p-6 mt-6 rounded-lg border border-slate-200 shadow-sm">
                        <h2 class="text-lg font-semibold text-slate-700">Paquetes Pendientes de Notificación</h2>
                        <div class="overflow-x-auto mt-4">
                            <table class="w-full text-sm">
                                <thead class="text-xs text-slate-700 uppercase bg-slate-100">
                                    <tr>
                                        <th class="px-6 py-3">Tracking</th>
                                        <th class="px-6 py-3">Cliente</th>
                                        <th class="px-6 py-3">Anaquel</th>
                                        <th class="px-6 py-3">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr><td colspan="4" class="text-center p-4 text-slate-500">Funcionalidad de paquetes pendiente.</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="lg:col-span-1">
                     <form id="form-confirmar" class="bg-white p-6 rounded-lg border border-slate-200 shadow-sm">
                        <h2 class="text-lg font-semibold text-slate-700 mb-4">Guardar en</h2>
                        <div class="space-y-4">
                            <div>
                                <label for="sucursal-destino" class="block text-sm font-medium text-slate-600 mb-1">Sucursal (Sesión)</label>
                                <input type="text" id="sucursal-destino" value="Cargando..." disabled class="w-full p-2 border border-slate-300 rounded-md bg-slate-100">
                            </div>
                            <div>
                                <label for="anaquel-destino" class="block text-sm font-medium text-slate-600 mb-1">Anaquel</label>
                                <select id="anaquel-destino" class="w-full p-2 border border-slate-300 rounded-md" required>
                                    <option value="">Cargando...</option>
                                </select>
                            </div>
                        </div>
                        <div class="mt-6 pt-6 border-t border-slate-200">
                            <h3 class="text-md font-semibold text-slate-700 mb-2">Info del Paquete</h3>
                            <div id="info-paquete-sucursal" class="text-sm text-slate-600 space-y-1">
                                <p>Esperando escaneo...</p>
                            </div>
                        </div>
                        <button type="submit" class="w-full mt-6 bg-sky-500 text-white font-bold py-3 px-4 rounded-lg shadow-lg shadow-sky-500/20 hover:bg-sky-600">Confirmar Recepción</button>
                   </form>
                </div>
            </div>
        </main>
    </div>

    <script type="module">
        import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

        // ===== INICIALIZACIÓN DE LA INTERFAZ (UI) =====
        document.addEventListener('DOMContentLoaded', () => {
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const sidebar = document.getElementById('sidebar');
            mobileMenuButton.addEventListener('click', () => {
                sidebar.classList.toggle('-translate-x-full');
            });

            const currentPage = window.location.pathname.split('/').pop();
            document.querySelectorAll('.sidebar-link').forEach(link => {
                if (link.dataset.path === currentPage) {
                    link.classList.add('active');
                }
            });

            initializeDatabaseLogic();
        });

        // ===== LÓGICA DE LA BASE DE DATOS (SUPABASE) =====
        function initializeDatabaseLogic() {
            try {
                const sb = createClient(window.PSC_CONFIG.supabaseUrl, window.PSC_CONFIG.supabaseAnonKey);

                const anaquelSelect = document.getElementById('anaquel-destino');
                const sucursalInput = document.getElementById('sucursal-destino');

                async function cargarAnaqueles() {
                    const { data, error } = await sb.from('anaqueles').select('nombre').order('nombre');
                    if(error) {
                        console.error("Error cargando anaqueles:", error);
                        anaquelSelect.innerHTML = `<option value="">Error al cargar</option>`;
                        return;
                    }
                    anaquelSelect.innerHTML = `<option value="">Seleccione un anaquel</option>`;
                    data.forEach(a => {
                        anaquelSelect.innerHTML += `<option value="${a.nombre}">${a.nombre}</option>`;
                    });
                }

                async function cargarSucursalActual() {
                    const { data, error } = await sb.from('sucursales').select('sucursal').limit(1).single();
                    if(error) {
                        console.error("Error cargando sucursal:", error);
                        sucursalInput.value = "Error";
                        return;
                    }
                    if(data) {
                        sucursalInput.value = data.sucursal;
                    } else {
                        sucursalInput.value = "No hay sucursales";
                    }
                }

                // Carga inicial
                cargarAnaqueles();
                cargarSucursalActual();

            } catch (error) {
                console.error("Error al inicializar Supabase:", error);
                document.querySelector('main').innerHTML = `<div class="text-center p-8 bg-white rounded-lg border col-span-full"><p class="text-red-500 font-semibold">Error de conexión a la base de datos.</p><p class="text-slate-500 mt-2">Verifica la consola para más detalles.</p></div>`;
            }
        }
    </script>
</body>
</html>
